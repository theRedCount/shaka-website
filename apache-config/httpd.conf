# Apache HTTP Server Configuration File

ServerRoot "/usr/local/apache2"
Listen 80

# Modules
LoadModule mpm_event_module modules/mod_mpm_event.so
LoadModule authz_core_module modules/mod_authz_core.so
LoadModule authz_host_module modules/mod_authz_host.so
LoadModule authz_user_module modules/mod_authz_user.so
LoadModule autoindex_module modules/mod_autoindex.so
LoadModule dir_module modules/mod_dir.so
LoadModule mime_module modules/mod_mime.so
LoadModule rewrite_module modules/mod_rewrite.so
LoadModule headers_module modules/mod_headers.so
LoadModule deflate_module modules/mod_deflate.so

# Basic Settings
ServerAdmin admin@localhost
ServerName localhost:80
DirectoryIndex index.html index.htm

# Security
ServerTokens Prod
ServerSignature Off

# Document Root
DocumentRoot "/usr/local/apache2/htdocs"

<Directory "/usr/local/apache2/htdocs">
    AllowOverride All
    Require all granted
    Options Indexes FollowSymLinks
</Directory>

# Configurazione speciale per le cartelle risorse e template con indexing attivo
<Directory "/usr/local/apache2/htdocs/risorse">
    Options +Indexes +FollowSymLinks
    AllowOverride All
    Require all granted
    
    # Personalizzazione dell'index
    IndexOptions FancyIndexing HTMLTable SuppressIcon SuppressRules
    IndexOptions NameWidth=* DescriptionWidth=*
    HeaderName /template/header.html
    ReadmeName /template/footer.html
</Directory>

<Directory "/usr/local/apache2/htdocs/template">
    Options +Indexes +FollowSymLinks
    AllowOverride All
    Require all granted
    
    # Personalizzazione dell'index
    IndexOptions FancyIndexing HTMLTable SuppressIcon SuppressRules
    IndexOptions NameWidth=* DescriptionWidth=*
</Directory>

# MIME Types
<IfModule mod_mime.c>
    TypesConfig conf/mime.types
    AddType application/x-compress .Z
    AddType application/x-gzip .gz .tgz
    AddType text/html .shtml
    AddOutputFilter INCLUDES .shtml
</IfModule>

# Compressione
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>

# Headers di sicurezza
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"
</IfModule>

# Log Files
ErrorLog /proc/self/fd/2
LogLevel warn
CustomLog /proc/self/fd/1 combined

# Virtual Host per il sito principale
<VirtualHost *:80>
    ServerName localhost
    DocumentRoot "/usr/local/apache2/htdocs"
    
    # Redirect per SEO-friendly URLs
    RewriteEngine On
    
    # Log per questo virtual host
    ErrorLog /proc/self/fd/2
    CustomLog /proc/self/fd/1 combined
</VirtualHost>